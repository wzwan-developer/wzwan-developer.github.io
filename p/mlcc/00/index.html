<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="ã€Š Targetless Extrinsic Calibration of Multiple Small FoV LiDARs and Cameras using Adaptive Voxelizationã€‹è§£è¯»ç³»åˆ—ã€‚"><title>Chapter 00: Adaptive Voxelization</title>
<link rel=canonical href=/p/mlcc/00/><link rel=stylesheet href=/scss/style.min.97647ae9d1ae42d5eb506cb3df5390c4a98ca9f026b51f91b3e94f56f6fe1153.css><meta property='og:title' content="Chapter 00: Adaptive Voxelization"><meta property='og:description' content="ã€Š Targetless Extrinsic Calibration of Multiple Small FoV LiDARs and Cameras using Adaptive Voxelizationã€‹è§£è¯»ç³»åˆ—ã€‚"><meta property='og:url' content='/p/mlcc/00/'><meta property='og:site_name' content='wzwan'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='mlcc'><meta property='article:published_time' content='2024-09-16T15:55:17+08:00'><meta property='article:modified_time' content='2024-11-17T14:33:30+08:00'><meta property='og:image' content='/p/mlcc/00/lidar_voxel.png'><meta name=twitter:title content="Chapter 00: Adaptive Voxelization"><meta name=twitter:description content="ã€Š Targetless Extrinsic Calibration of Multiple Small FoV LiDARs and Cameras using Adaptive Voxelizationã€‹è§£è¯»ç³»åˆ—ã€‚"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content='/p/mlcc/00/lidar_voxel.png'><link rel="shortcut icon" href=/favicon.ico><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><meta name=referrer content="no-referrer-when-downgrade"><script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js></script><script>MathJax={tex:{displayMath:[["\\[","\\]"],["$$","$$"]],inlineMath:[["$","$"]]}}</script></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=åˆ‡æ¢èœå•>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu13765723581977241775.png width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>ğŸ§</span></figure><div class=site-meta><h1 class=site-name><a href=/>wzwan</a></h1><h2 class=site-description>ä¸€åˆ‡çœŸçŸ¥éƒ½æ˜¯ä»ç›´æ¥ç»éªŒå‘æºçš„ã€‚</h2></div></header><ol class=menu-social><li><a href=mailto:wz.wang.work@outlook.com target=_blank title=wz.wang.work@outlook.com rel=me><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-mail"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 7a2 2 0 012-2h14a2 2 0 012 2v10a2 2 0 01-2 2H5a2 2 0 01-2-2V7z"/><path d="M3 7l9 6 9-6"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>ä¸»é¡µ</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>å½’æ¡£</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>æœç´¢</span></a></li><li><a href=/%E5%8F%8B%E6%83%85%E9%93%BE%E6%8E%A5/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>å‹æƒ…é“¾æ¥</span></a></li><li class=menu-bottom-section><ol class=menu></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">ç›®å½•</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#æ–‡ç« å†…å®¹>æ–‡ç« å†…å®¹</a></li><li><a href=#ç›¸å…³ç†è®º>ç›¸å…³ç†è®º</a><ol><li><a href=#è‡ªé€‚åº”ä½“ç´ åŒ–>è‡ªé€‚åº”ä½“ç´ åŒ–</a></li><li><a href=#å…«å‰æ ‘æ•°æ®ç»“æ„>å…«å‰æ ‘æ•°æ®ç»“æ„</a></li></ol></li><li><a href=#ä»£ç è¯¦è§£>ä»£ç è¯¦è§£</a><ol><li><a href=#octo_treeç±»>OCTO_TREEç±»</a></li><li><a href=#downsample_voxelä½“ç´ ä¸‹é‡‡æ ·å‡½æ•°>downsample_voxelä½“ç´ ä¸‹é‡‡æ ·å‡½æ•°</a></li><li><a href=#cut_voxelä½“ç´ è£å‰ªå‡½æ•°>cut_voxelä½“ç´ è£å‰ªå‡½æ•°</a></li></ol></li><li><a href=#å‚è€ƒæ–‡çŒ®>å‚è€ƒæ–‡çŒ®</a></li></ol></nav></div></section></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/p/mlcc/00/><img src=/p/mlcc/00/lidar_voxel_hu6953859510362683865.png srcset="/p/mlcc/00/lidar_voxel_hu6953859510362683865.png 800w, /p/mlcc/00/lidar_voxel_hu11019935435565024287.png 1600w" width=800 height=280 loading=lazy alt="Featured image of post Chapter 00: Adaptive Voxelization"></a></div><div class=article-details><header class=article-category><a href=/categories/calibrate/ style=background-color:#2a9d8f;color:#fff>ä¼ æ„Ÿå™¨æ ‡å®š</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/mlcc/00/>Chapter 00: Adaptive Voxelization</a></h2><h3 class=article-subtitle>ã€Š Targetless Extrinsic Calibration of Multiple Small FoV LiDARs and Cameras using Adaptive Voxelizationã€‹è§£è¯»ç³»åˆ—ã€‚</h3></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>2024-09-16</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>é˜…è¯»æ—¶é•¿: 11 åˆ†é’Ÿ</time></div><div class=article-analysic>&nbsp
            
            <!doctype html><svg t="1725155025621" class="icon" viewBox="0 0 1024 1024" p-id="4312" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200"><path d="M979.222 415.474c-84.268-83.454-202.912-223.47-469.264-223.47-266.316.0-384.962 140.016-469.23 223.47-19.86 19.682-30.788 45.784-30.788 73.534.0 27.728 10.93 53.85 30.788 73.51 84.27 83.476 202.896 223.47 469.23 223.47 266.368.0 384.996-139.994 469.264-223.47 19.86-19.66 30.79-45.784 30.79-73.51C1010.01 461.256 999.082 435.156 979.222 415.474zm-38.34 108.808C862.556 601.838 756.802 732 509.958 732c-246.81.0-352.564-130.164-430.89-207.718-9.548-9.468-14.8-22.01-14.8-35.276.0-13.288 5.252-25.806 14.8-35.252 78.344-77.578 184.098-207.764 430.89-207.764 246.826.0 352.58 130.186 430.924 207.764 9.55 9.446 14.802 21.966 14.802 35.252C955.684 502.272 950.432 514.812 940.882 524.282zM509.974 335.996c-84.868.0-153.928 68.652-153.928 152.988.0 84.358 69.06 153.01 153.928 153.01 84.872.0 153.93-68.652 153.93-153.01C663.904 404.648 594.846 335.996 509.974 335.996zm0 252.012c-54.912.0-99.6-44.428-99.6-99.024.0-54.574 44.69-98.978 99.6-98.978 54.912.0 99.6 44.404 99.6 98.978C609.576 543.58 564.888 588.008 509.974 588.008z" p-id="4313"/></svg>
<time class=article-words><span id=busuanzi_container_page_pv><span id=busuanzi_value_page_pv></span> &nbspé˜…è¯»</span></time></div></footer></div></header><section class=article-content><h2 id=æ–‡ç« å†…å®¹>æ–‡ç« å†…å®¹</h2><blockquote><p>Â Â Â Â Â Â Â Â Â Â To find the correspondences among different LiDAR scans, we assume the initial base LiDAR trajectory $\mathcal{S}$, LiDAR extrinsic $\mathcal{E}_L$, and camera extrinsic $\mathcal{E}_C$ are available. The initial base LiDAR trajectory $\mathcal{S}$ could be obtained by an online LiDAR SLAM (e.g., [3]), and the initial extrinsic could be obtained from the CAD design or a rough Hand-Eye calibration [14].
Our previous work [5] extracts edge and plane feature points from each LiDAR scan and matches them to the nearby edge and plane points in the map by a $k$-nearest neighbor search ($k-NN$). This would repeatedly build a $k$-d tree of the global map at each iteration. In this paper, we use a more efficient voxel map proposed in [4] to create correspondences among all LiDAR scans.</p></blockquote><p>Â Â Â Â Â Â Â Â ä¸ºäº†æ‰¾åˆ°ä¸åŒé›·è¾¾æ‰«æä¹‹é—´çš„å¯¹åº”å…³ç³»ï¼Œæˆ‘ä»¬å‡è®¾åˆå§‹çš„åŸºå‡†é›·è¾¾è½¨è¿¹$\mathcal{S}$ã€é›·è¾¾å¤–å‚$\mathcal{E}_L$ã€ç›¸æœºå¤–å‚$\mathcal{E}_C$æ˜¯å¯ç”¨çš„ã€‚åˆå§‹çš„åŸºå‡†é›·è¾¾è½¨è¿¹$\mathcal{S}$å¯ä»¥é€šè¿‡å®æ—¶é›·è¾¾SLAMè·å¾—ï¼Œè€Œåˆå§‹çš„å¤–å‚å¯ä»¥é€šè¿‡CADè®¾è®¡æˆ–è€…ä»ç²—ç•¥çš„æ‰‹çœ¼æ ‡å®šä¸­è·å¾—ã€‚æˆ‘ä»¬çš„å‰æœŸå·¥ä½œï¼Œä»æ¯ä¸ªé›·è¾¾æ‰«æä¸­æå–è¾¹ç¼˜å’Œå¹³é¢ç‰¹å¾ï¼Œå¹¶é€šè¿‡æœ€é‚»åŸŸæœç´¢ï¼Œå°†ä»–ä»¬åŒ¹é…åˆ°åœ°å›¾ä¸­çš„ä¸´è¿‘è¾¹ç¼˜å’Œå¹³é¢ã€‚è¿™ä¼šåœ¨æ¯æ¬¡è¿­ä»£ä¸­é‡å¤æ„å»ºå…¨å±€åœ°å›¾çš„$k$-dæ ‘ï¼Œåœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨åœ¨æ–‡çŒ®4ä¸­æå‡ºçš„ä¸€ç§æ›´ä¸ºé«˜æ•ˆçš„ä½“ç´ åœ°å›¾æ¥åˆ›å»ºæ‰€æœ‰é›·è¾¾æ‰«æä¹‹é—´çš„å¯¹åº”å…³ç³»ã€‚</p><blockquote><p>Â Â Â Â Â Â Â Â Â Â The voxel map is built by cutting the point cloud (registered using the current $\mathcal{S}$ and $\mathcal{E}_L$) into small voxels such that all points in a voxel roughly lie on a plane (with some adjustable tolerance). The main problem of the fixed-resolution voxel map is that if the resolution is high, the segmentation would be too time-consuming, while if the resolution is too low, multiple small planes in the environments falling into the same voxel would not be segmented. To best adapt to the environment, we implement an adaptive voxelization process. More specifically, the entire map is first cut into voxels with a pre-set size (usually large, e.g., 4m). Then for each voxel, if the contained points from all LiDAR scans roughly form a plane (by checking the ratio between eigenvalues), it is treated as a planar voxel; otherwise, they will be divided into eight octants, where each will be examined again until the contained points roughly form a plane or the voxel size reaches the pre-set minimum lower bound. Moreover, the adaptive voxelization is performed directly on the LiDAR raw points, so no prior feature points extraction is needed as in [5].</p></blockquote><p>Â Â Â Â Â Â Â Â ä½“ç´ åœ°å›¾é€šè¿‡å°†ç‚¹äº‘ï¼ˆä½¿ç”¨å½“å‰çš„ $\mathcal{S}$å’Œ $\mathcal{E}_L$ è¿›è¡Œé…å‡†ï¼‰åˆ‡å‰²æˆå°çš„ä½“ç´ æ¥æ„å»ºï¼Œä½¿å¾—ä½“ç´ å†…çš„æ‰€æœ‰ç‚¹å¤§è‡´ä½äºåŒä¸€å¹³é¢ä¸Šï¼ˆå…·æœ‰ä¸€å®šçš„å¯è°ƒå®¹å·®ï¼‰ã€‚å›ºå®šåˆ†è¾¨ç‡ä½“ç´ å›¾çš„ä¸»è¦é—®é¢˜æ˜¯ï¼Œå¦‚æœåˆ†è¾¨ç‡å¤ªé«˜ï¼Œåˆ†å‰²å°†ä¼šéå¸¸è€—æ—¶ï¼›è€Œå¦‚æœåˆ†è¾¨ç‡å¤ªä½ï¼Œç¯å¢ƒä¸­å¤šä¸ªå°å¹³é¢è½åœ¨åŒä¸€ä¸ªä½“ç´ å†…æ—¶åˆ™æ— æ³•è¿›è¡Œåˆ†å‰²ã€‚ä¸ºäº†æ›´å¥½åœ°é€‚åº”ç¯å¢ƒï¼Œæˆ‘ä»¬å®ç°äº†è‡ªé€‚åº”ä½“ç´ åŒ–è¿‡ç¨‹ã€‚
å…·ä½“æ¥è¯´ï¼Œæ•´ä¸ªåœ°å›¾é¦–å…ˆè¢«åˆ‡å‰²æˆé¢„è®¾å¤§å°çš„ä½“ç´ ï¼ˆé€šå¸¸è¾ƒå¤§ï¼Œä¾‹å¦‚4ç±³ï¼‰ã€‚ç„¶åå¯¹äºæ¯ä¸ªä½“ç´ ï¼Œå¦‚æœæ‰€æœ‰LiDARæ‰«æä¸­åŒ…å«çš„ç‚¹å¤§è‡´å½¢æˆä¸€ä¸ªå¹³é¢ï¼ˆé€šè¿‡æ£€æŸ¥ç‰¹å¾å€¼ä¹‹é—´çš„æ¯”ç‡æ¥åˆ¤æ–­ï¼‰ï¼Œåˆ™å°†å…¶è§†ä¸ºå¹³é¢ä½“ç´ ï¼›å¦åˆ™ï¼Œè¿™äº›ä½“ç´ å°†è¢«åˆ†æˆå…«ä¸ªå…«åˆ†ä¹‹ä¸€ä½“ç´ ï¼ˆoctantsï¼‰ï¼Œæ¯ä¸ªéƒ½å°†å†æ¬¡è¿›è¡Œæ£€æŸ¥ï¼Œç›´åˆ°åŒ…å«çš„ç‚¹å¤§è‡´å½¢æˆä¸€ä¸ªå¹³é¢ï¼Œæˆ–è€…ä½“ç´ å°ºå¯¸è¾¾åˆ°é¢„è®¾çš„æœ€å°ä¸‹é™ã€‚æ­¤å¤–ï¼Œè‡ªé€‚åº”ä½“ç´ åŒ–ç›´æ¥åœ¨LiDARçš„åŸå§‹ç‚¹ä¸Šæ‰§è¡Œï¼Œå› æ­¤ä¸éœ€è¦åƒæ–‡çŒ®[5]é‚£æ ·é¢„å…ˆæå–ç‰¹å¾ç‚¹ã€‚</p><blockquote><p>Â Â Â Â Â Â Â Â Â Â Fig. 3 shows a typical result of the adaptive voxelization process in a complicated campus environment. As can be seen, this process is able to segment planes of different sizes, including large planes on the ground, medium planes on the building walls, and tiny planes on tree crowns.
<img src=/p/mlcc/00/adaptive_voxelization.png width=2574 height=930 srcset="/p/mlcc/00/adaptive_voxelization_hu12395980834133490816.png 480w, /p/mlcc/00/adaptive_voxelization_hu3118485833705387669.png 1024w" loading=lazy alt=å›¾3 class=gallery-image data-flex-grow=276 data-flex-basis=664px>
Fig. 3: A) LiDAR point cloud segmented with the adaptive voxelization. Points within the same voxel are colored identically. The detailed adaptive voxelization of points in the dashed white rectangle could be viewed in B) colored points and C) original points. The default size for the initial voxelization is 4m, and the minimum voxel size is 0.25m.</p></blockquote><p>å›¾3å±•ç¤ºäº†ä¸€ä¸ªå¤æ‚æ ¡å›­ç¯å¢ƒä¸­è‡ªé€‚åº”ä½“ç´ åŒ–è¿‡ç¨‹çš„å…¸å‹ç»“æœã€‚å¦‚å›¾æ‰€ç¤ºï¼Œè¯¥è¿‡ç¨‹èƒ½å¤Ÿåˆ†å‰²å‡ºä¸åŒå¤§å°çš„å¹³é¢ï¼ŒåŒ…æ‹¬åœ°é¢ä¸Šçš„å¤§å¹³é¢ã€å»ºç­‘ç‰©å¢™é¢ä¸Šçš„ä¸­ç­‰å¹³é¢ä»¥åŠæ ‘å† ä¸Šçš„å°å¹³é¢ã€‚
<img src=/p/mlcc/00/adaptive_voxelization.png width=2574 height=930 srcset="/p/mlcc/00/adaptive_voxelization_hu12395980834133490816.png 480w, /p/mlcc/00/adaptive_voxelization_hu3118485833705387669.png 1024w" loading=lazy alt=å›¾3 class=gallery-image data-flex-grow=276 data-flex-basis=664px>
å›¾3ï¼š(A) ä½¿ç”¨è‡ªé€‚åº”ä½“ç´ åŒ–åˆ†å‰²çš„LiDARç‚¹äº‘ã€‚åŒä¸€ä½“ç´ å†…çš„ç‚¹è¢«èµ‹äºˆç›¸åŒçš„é¢œè‰²ã€‚ç™½è‰²è™šçº¿çŸ©å½¢åŒºåŸŸå†…çš„è¯¦ç»†è‡ªé€‚åº”ä½“ç´ åŒ–æ•ˆæœå¯ä»¥åœ¨ (B) å½©è‰²ç‚¹äº‘å’Œ (C) åŸå§‹ç‚¹äº‘ä¸­æŸ¥çœ‹ã€‚åˆå§‹ä½“ç´ åŒ–çš„é»˜è®¤å¤§å°ä¸º4ç±³ï¼Œè€Œæœ€å°çš„ä½“ç´ å¤§å°ä¸º0.25ç±³ã€‚</p><h2 id=ç›¸å…³ç†è®º>ç›¸å…³ç†è®º</h2><p>è®ºæ–‡ä¸­å…³äºè‡ªé€‚åº”ä½“ç´ å¹¶æœªæåŠåˆ°é‡è¦ä¿¡æ¯ï¼Œä½†æ˜¯æåˆ°äº†å‚è€ƒæ–‡çŒ®4<a class=link href=https://www.arxiv.org/pdf/2010.08215 target=_blank rel=noopener>ã€ŠBALM: Bundle Adjustment for Lidar Mappingã€‹</a>ã€‚</p><h3 id=è‡ªé€‚åº”ä½“ç´ åŒ–>è‡ªé€‚åº”ä½“ç´ åŒ–</h3><p>Â Â Â Â Â Â Â Â æˆ‘ä»¬åœ¨é»˜è®¤å¤§å°çš„3Dç©ºé—´ä¸­é‡å¤ä½“ç´ åŒ–ï¼Œå¦‚æœå½“å‰ä½“ç´ ä¸­çš„æ‰€æœ‰ç‰¹å¾ç‚¹éƒ½ä½äºå¹³é¢ï¼Œåˆ™å°†å½“å‰ä½“ç´ ä¸åŒ…å«çš„ç‰¹å¾ç‚¹ä¸€èµ·ä¿å­˜åœ¨å†…å­˜ä¸­ï¼›å¦åˆ™ï¼Œå°†å½“å‰ä½“ç´ åˆ†è§£ä¸ºå…«ä¸ªå…«åˆ†ä½“ï¼Œå¹¶ç»§ç»­æ£€æŸ¥æ¯ä¸ªå…«åˆ†ä½“ç›´åˆ°è¾¾åˆ°æœ€å°å°ºå¯¸ã€‚åœ¨å…·ä½“å®ç°è¿‡ç¨‹ä¸­æœ‰ä»¥ä¸‹ç»†èŠ‚ï¼š</p><ul><li>å¦‚æœä¸€ä¸ªä½“ç´ å†…åŒ…å«å¤ªå¤šçš„ç‰¹å¾ç‚¹ï¼Œåˆ™ä¼šå¯¼è‡´æ–‡ç« <a class=link href=/p/mlcc/01/>ã€ŠChapter 01: Multi-LiDAR Extrinsic Calibrationã€‹</a>ä¸­æ¨å¯¼è¿‡ç¨‹ç« èŠ‚ä¸­äºŒé˜¶é—­å¼å¯¼æ•°ä¸­çš„HessiançŸ©é˜µç»´åº¦è¿‡é«˜ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥å°†ç‚¹è¿›è¡Œå¹³å‡ï¼Œä»¥å®ç°é™é‡‡æ ·ä½†ä¸é™ä½æ˜ å°„ä¸€è‡´æ€§ï¼›</li><li>åŒæ—¶ï¼ŒäºŒé˜¶é—­å¼å¯¼æ•°ä¸­çš„HessiançŸ©é˜µæ¨å¯¼è¿‡ç¨‹ä¸­æåˆ°$\lambda_m\ne\lambda_n$,å› æ­¤å½“é‡åˆ°$\lambda$çš„ä»£æ•°å¤šé‡æ€§å¤§äº1çš„ä½“ç´ éœ€è¦è·³è¿‡ï¼ˆå¿½ç•¥ï¼‰ï¼›</li><li>åªéœ€æ£€æŸ¥ä½“ç´ æ‰€åŒ…å«çš„ç‚¹ï¼Œæ˜¯å¦ä½äºåŒä¸€å¹³é¢æ—¶å…è®¸æ›´å¤§çš„æ–¹å·®ï¼Œåˆ™èƒ½è‡ªç„¶åœ°æ‰©å±•åˆ°éå¹³é¢ç‰¹å¾ï¼ˆBALMåªæåˆ°äº†å¹³é¢ç‰¹å¾å’Œè¾¹ç¼˜ç‰¹å¾ï¼‰ï¼›</li><li>è®¾ç½®äº†ä¸¤ä¸ªæ¡ä»¶æ¥åœæ­¢é€’å½’ä½“ç´ åŒ–ï¼šä¸€ä¸ªæ˜¯æ ‘çš„æœ€å¤§æ·±åº¦ï¼Œå¦ä¸€ä¸ªæ˜¯ä½“ç´ çš„æœ€å°ç‚¹æ•°ã€‚</li></ul><p>Â Â Â Â Â Â Â Â å…¶ä¸­ï¼Œåˆ¤æ–­ä½“ç´ æ˜¯å¦ä¸ºå¹³é¢çš„æ–¹æ³•æ˜¯è®¡ç®—ä½“ç´ å†…æ‰€æœ‰çš„ç‚¹äº‘çš„åæ–¹å·®çŸ©é˜µï¼Œåˆ¤æ–­æœ€å¤§ç‰¹å¾å€¼ä¸æœ€å°ç‰¹å¾å€¼çš„æ¯”å€¼æ˜¯å¦å¤§äºä¸€å®šçš„é˜ˆå€¼ï¼Œå¦‚æœå¤§äºåˆ™ä¸ºå¹³é¢ï¼š</p>$$
p_c=\frac{1}{N}\sum_{i=1}^{N}p_i
$$$$
\begin{align*}
C=\frac{1}{N}\sum_{i=1}^{N}\big(p_i - c\big)\big(p_i - c\big)^T\\
=\frac{1}{N}\sum_{i=1}^{N}\big(p_ip_i^T-p_ic^T-cp_i^T+cc^T\big)\\
=\frac{1}{N}\sum_{i=1}^{N}p_ip_i^T-\frac{1}{N}\sum_{i=1}^{N}p_ic^T
-c\big(\frac{1}{N}\sum_{i=1}^{N}p_i\big)^T+cc^T\\
=\frac{1}{N}\sum_{i=1}^{N}p_ip_i^T-cc^T-cc^T+cc^T\\
=\frac{1}{N}\sum_{i=1}^{N}p_ip_i^T-cc^T
\end{align*}
$$<h3 id=å…«å‰æ ‘æ•°æ®ç»“æ„>å…«å‰æ ‘æ•°æ®ç»“æ„</h3><p><img src=/p/mlcc/00/octree.png width=431 height=260 srcset="/p/mlcc/00/octree_hu12793898556502101269.png 480w, /p/mlcc/00/octree_hu14844167966149893531.png 1024w" loading=lazy alt=å…«å‰æ ‘ç»“æ„ç¤ºæ„å›¾ class=gallery-image data-flex-grow=165 data-flex-basis=397px></p><p>Â Â Â Â Â Â Â Â é€šè¿‡é›·è¾¾è·å–çš„ç‚¹äº‘æ•°æ®ï¼Œå…·æœ‰æ•°æ®é‡å¤§ã€åˆ†å¸ƒä¸å‡åŒ€ç­‰ç‰¹ç‚¹ã€‚ç‚¹äº‘æ•°æ®ä¸»è¦æ˜¯è¡¨å¾ç›®æ ‡è¡¨é¢çš„æµ·é‡ç‚¹é›†åˆï¼Œå¹¶ä¸å…·å¤‡ä¼ ç»Ÿç½‘æ ¼æ•°æ®çš„é›†åˆæ‹“æ‰‘ä¿¡æ¯ã€‚æ‰€ä»¥ç‚¹äº‘æ•°æ®å¤„ç†ä¸­æœ€ä¸ºæ ¸å¿ƒçš„é—®é¢˜å°±æ˜¯å»ºç«‹ç¦»æ•£ç‚¹é—´çš„æ‹“æ‰‘å…³ç³»ï¼Œå®ç°åŸºäºé‚»åŸŸå…³ç³»çš„å¿«é€ŸæŸ¥æ‰¾ã€‚</p><p>Â Â Â Â Â Â Â Â å»ºç«‹ç©ºé—´ç´¢å¼•åœ¨ç‚¹äº‘æ•°æ®å¤„ç†ä¸­å·²è¢«å¹¿æ³›åº”ç”¨ï¼Œå¸¸è§ç©ºé—´ç´¢å¼•ä¸€èˆ¬æ˜¯è‡ªé¡¶å‘ä¸‹é€çº§åˆ’åˆ†ç©ºé—´çš„å„ç§ç©ºé—´ç´¢å¼•ç»“æ„ï¼Œæ¯”è¾ƒæœ‰ä»£è¡¨æ€§çš„åŒ…æ‹¬ BSPæ ‘ã€ KDæ ‘ã€ KDBæ ‘ã€ Ræ ‘ã€ R+æ ‘ã€ CELLæ ‘ã€å››å‰æ ‘å’Œå…«å‰æ ‘ç­‰ç´¢å¼•ç»“æ„ï¼Œè€Œåœ¨è¿™äº›ç»“æ„ä¸­KDæ ‘å’Œå…«å‰æ ‘åœ¨3Dç‚¹äº‘æ•°æ®ç»„ç»‡ä¸­åº”ç”¨è¾ƒä¸ºå¹¿æ³›ã€‚</p><p>Â Â Â Â Â Â Â Â å…«å‰æ ‘ï¼ˆOctreeï¼‰æ˜¯ä¸€ç§ç”¨äºæè¿°ä¸‰ç»´ç©ºé—´çš„æ ‘çŠ¶æ•°æ®ç»“æ„ã€‚å…«å‰æ ‘çš„æ¯ä¸ªèŠ‚ç‚¹è¡¨ç¤ºä¸€ä¸ªæ­£æ–¹ä½“çš„ä½“ç§¯å…ƒç´ ï¼Œæ¯ä¸ªèŠ‚ç‚¹æœ‰8ä¸ªå­èŠ‚ç‚¹ï¼Œè¿™å…«ä¸ªå­èŠ‚ç‚¹æ‰€è¡¨ç¤ºçš„ä½“ç§¯å…ƒç´ åŠ åœ¨ä¸€èµ·ç­‰äºçˆ¶èŠ‚ç‚¹çš„ä½“ç§¯ã€‚ä¸€èˆ¬ä¸­å¿ƒç‚¹ä½œä¸ºèŠ‚ç‚¹çš„åˆ†å‰ä¸­å¿ƒã€‚å…«å‰æ ‘è‹¥ä¸ä¸ºç©ºæ ‘çš„è¯ï¼Œæ ‘ä¸­ä»»ä¸€èŠ‚ç‚¹çš„å­èŠ‚ç‚¹æ°å¥½åªä¼šæ˜¯8ä¸ªæˆ–0ä¸ªï¼Œä¸ä¼šæ˜¯0æˆ–8ä»¥å¤–çš„æ•°ç›®ã€‚å…«å‰æ ‘å¶å­èŠ‚ç‚¹ä»£è¡¨äº†åˆ†è¾¨ç‡æœ€é«˜çš„æƒ…å†µã€‚ä¾‹å¦‚åˆ†è¾¨ç‡è®¾æˆ0.01mï¼Œé‚£ä¹ˆæ¯ä¸ªå¶å­å°±æ˜¯ä¸€ä¸ª1cmè§æ–¹çš„å°æ–¹å—ã€‚</p><h2 id=ä»£ç è¯¦è§£>ä»£ç è¯¦è§£</h2><p>å¤šæ¿€å…‰é›·è¾¾æ ‡å®šçš„å…·ä½“å®ç°ä¸è®ºæ–‡æ˜¯æœ‰å·®å¼‚çš„ï¼Œè¢«æ‹†ä¸ºä¸‰æ­¥å®ç°ä»¥é™ä½ç»´åº¦ï¼Œæ¯æ­¥éƒ½ä¼šæ¶‰åŠçš„è‡ªé€‚åº”ä½“ç´ åŒ–ï¼Œå…¶ä»£ç å¤§åŒå°å¼‚ï¼Œæœ¬æ–‡ä»£ç ç‰‡æ®µèŠ‚é€‰è‡ªç¬¬ä¸‰æ­¥éª¤ï¼Œå…·ä½“å‚è€ƒglobal.hppå’Œglobal.cppã€‚</p><h3 id=octo_treeç±»>OCTO_TREEç±»</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span><span class=lnt>182
</span><span class=lnt>183
</span><span class=lnt>184
</span><span class=lnt>185
</span><span class=lnt>186
</span><span class=lnt>187
</span><span class=lnt>188
</span><span class=lnt>189
</span><span class=lnt>190
</span><span class=lnt>191
</span><span class=lnt>192
</span><span class=lnt>193
</span><span class=lnt>194
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-C++ data-lang=C++><span class=line><span class=cl><span class=k>class</span> <span class=nc>OCTO_TREE</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>	<span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=n>vector_vec3d</span><span class=o>*&gt;</span> <span class=n>baseOriginPc</span><span class=p>;</span><span class=c1>//åŸºå‡†é›·è¾¾çš„åŸå§‹ç‚¹äº‘
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=n>vector_vec3d</span><span class=o>*&gt;</span> <span class=n>baseTransPc</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=n>vector_vec3d</span><span class=o>*&gt;&gt;</span> <span class=n>refOriginPc</span><span class=p>;</span> <span class=c1>// nä¸ªå‚è€ƒé›·è¾¾çš„åŸå§‹ç‚¹äº‘
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=n>vector_vec3d</span><span class=o>*&gt;&gt;</span> <span class=n>refTransPc</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>OCTO_TREE</span><span class=o>*</span> <span class=n>leaves</span><span class=p>[</span><span class=mi>8</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>win_size</span><span class=p>,</span> <span class=c1>//å¸§æ•°
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>ref_size</span><span class=p>,</span> <span class=c1>//å‚è€ƒé›·è¾¾çš„ä¸ªæ•°
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>points_size</span><span class=p>,</span> <span class=n>layer</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>OT_STATE</span> <span class=n>octo_state</span><span class=p>;</span><span class=c1>//å…«å‰æ ‘èŠ‚ç‚¹ç±»å‹
</span></span></span><span class=line><span class=cl><span class=c1></span>	
</span></span><span class=line><span class=cl>	<span class=kt>double</span> <span class=n>voxel_center</span><span class=p>[</span><span class=mi>3</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=kt>double</span> <span class=n>quater_length</span><span class=p>,</span> <span class=n>eigen_ratio</span><span class=p>;</span><span class=c1>//é¢ç‰¹å¾çš„é˜ˆå€¼
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>Eigen</span><span class=o>::</span><span class=n>Vector3d</span> <span class=n>value_vector</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=n>OCTO_TREE</span><span class=p>(</span><span class=kt>int</span> <span class=n>window_size</span><span class=p>,</span> <span class=kt>double</span> <span class=n>ref_lidar_size</span><span class=p>,</span> <span class=kt>double</span> <span class=n>eigen_limit</span><span class=p>)</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=n>win_size</span><span class=p>(</span><span class=n>window_size</span><span class=p>),</span> <span class=n>ref_size</span><span class=p>(</span><span class=n>ref_lidar_size</span><span class=p>),</span> <span class=n>eigen_ratio</span><span class=p>(</span><span class=n>eigen_limit</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=n>octo_state</span> <span class=o>=</span> <span class=n>UNKNOWN</span><span class=p>;</span> <span class=n>layer</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=mi>8</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=n>leaves</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=k>nullptr</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>win_size</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=n>baseOriginPc</span><span class=p>.</span><span class=n>emplace_back</span><span class=p>(</span><span class=k>new</span> <span class=n>vector_vec3d</span><span class=p>());</span>
</span></span><span class=line><span class=cl>			<span class=n>baseTransPc</span><span class=p>.</span><span class=n>emplace_back</span><span class=p>(</span><span class=k>new</span> <span class=n>vector_vec3d</span><span class=p>());</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>j</span> <span class=o>&lt;</span> <span class=n>ref_size</span><span class=p>;</span> <span class=n>j</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=n>vector_vec3d</span><span class=o>*&gt;</span> <span class=n>refOriginPc_</span><span class=p>,</span> <span class=n>refTransPc_</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>win_size</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=p>{</span>
</span></span><span class=line><span class=cl>				<span class=n>refOriginPc_</span><span class=p>.</span><span class=n>emplace_back</span><span class=p>(</span><span class=k>new</span> <span class=n>vector_vec3d</span><span class=p>());</span>
</span></span><span class=line><span class=cl>				<span class=n>refTransPc_</span><span class=p>.</span><span class=n>emplace_back</span><span class=p>(</span><span class=k>new</span> <span class=n>vector_vec3d</span><span class=p>());</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>			<span class=n>refOriginPc</span><span class=p>.</span><span class=n>emplace_back</span><span class=p>(</span><span class=n>refOriginPc_</span><span class=p>);</span>
</span></span><span class=line><span class=cl>			<span class=n>refTransPc</span><span class=p>.</span><span class=n>emplace_back</span><span class=p>(</span><span class=n>refTransPc_</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=c1>// feat_eigen_limit = 10;
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=o>~</span><span class=n>OCTO_TREE</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>win_size</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=k>delete</span> <span class=p>(</span><span class=n>baseOriginPc</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>			<span class=k>delete</span> <span class=p>(</span><span class=n>baseTransPc</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=n>baseOriginPc</span><span class=p>.</span><span class=n>clear</span><span class=p>();</span>
</span></span><span class=line><span class=cl>		<span class=n>baseTransPc</span><span class=p>.</span><span class=n>clear</span><span class=p>();</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>ref_size</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>j</span> <span class=o>&lt;</span> <span class=n>win_size</span><span class=p>;</span> <span class=n>j</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=p>{</span>
</span></span><span class=line><span class=cl>				<span class=k>delete</span> <span class=n>refOriginPc</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>];</span>
</span></span><span class=line><span class=cl>				<span class=k>delete</span> <span class=n>refTransPc</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>];</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>			<span class=n>refOriginPc</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>clear</span><span class=p>();</span>
</span></span><span class=line><span class=cl>			<span class=n>refTransPc</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>clear</span><span class=p>();</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=n>refOriginPc</span><span class=p>.</span><span class=n>clear</span><span class=p>();</span>
</span></span><span class=line><span class=cl>		<span class=n>refTransPc</span><span class=p>.</span><span class=n>clear</span><span class=p>();</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=mi>8</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=n>leaves</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>!=</span> <span class=k>nullptr</span><span class=p>)</span>
</span></span><span class=line><span class=cl>				<span class=k>delete</span> <span class=n>leaves</span><span class=p>[</span><span class=n>i</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>        * @brief å¯¹å…«å‰æ ‘èŠ‚ç‚¹è¿›è¡Œåˆ†å‰²
</span></span></span><span class=line><span class=cl><span class=cm>        **/</span>
</span></span><span class=line><span class=cl>        <span class=kt>void</span> <span class=nf>recut</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>             <span class=c1>// å¦‚æœå½“å‰å…«å‰æ ‘èŠ‚ç‚¹çš„çŠ¶æ€æœªçŸ¥ï¼Œåˆ™è¿›è¡Œåˆ†å‰²å†³ç­–
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>if</span> <span class=p>(</span><span class=n>octo_state</span> <span class=o>==</span> <span class=n>UNKNOWN</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>points_size</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>win_size</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>points_size</span> <span class=o>+=</span> <span class=n>baseOriginPc</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>-&gt;</span><span class=n>size</span><span class=p>();</span>
</span></span><span class=line><span class=cl>                <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>j</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>j</span> <span class=o>&lt;</span> <span class=n>ref_size</span><span class=p>;</span> <span class=n>j</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=n>points_size</span> <span class=o>+=</span> <span class=n>refOriginPc</span><span class=p>[</span><span class=n>j</span><span class=p>][</span><span class=n>i</span><span class=p>]</span><span class=o>-&gt;</span><span class=n>size</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=c1>// ä¸¤ä¸ªåœæ­¢é€’å½’ä½“ç´ åŒ–çš„æ¡ä»¶ä¹‹ä¸€ï¼šå¦‚æœç‚¹çš„æ€»å¤§å°å°äºæœ€å°å€¼ï¼Œåˆ™å°†å½“å‰èŠ‚ç‚¹æ ‡è®°ä¸ºä¸­é—´èŠ‚ç‚¹å¹¶è¿”å›
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=k>if</span> <span class=p>(</span><span class=n>points_size</span> <span class=o>&lt;</span> <span class=n>MIN_PS</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>octo_state</span> <span class=o>=</span> <span class=n>MID_NODE</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=c1>// åˆ¤æ–­æ˜¯å¦æ»¡è¶³å¹³é¢æ¡ä»¶ï¼Œå¦‚æœæ»¡è¶³åˆ™å°†å½“å‰èŠ‚ç‚¹æ ‡è®°ä¸ºå¹³é¢èŠ‚ç‚¹å¹¶è¿”å›
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=k>if</span> <span class=p>(</span><span class=n>judge_eigen</span><span class=p>())</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>octo_state</span> <span class=o>=</span> <span class=n>PLANE</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=c1>// ä¸¤ä¸ªåœæ­¢é€’å½’ä½“ç´ åŒ–çš„æ¡ä»¶ä¹‹ä¸€ï¼š å¦‚æœå½“å‰å±‚è¾¾åˆ°é™åˆ¶ï¼Œåˆ™å°†å½“å‰èŠ‚ç‚¹æ ‡è®°ä¸ºä¸­é—´èŠ‚ç‚¹å¹¶è¿”å›
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=k>if</span> <span class=p>(</span><span class=n>layer</span> <span class=o>==</span> <span class=n>LAYER_LIMIT</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=n>octo_state</span> <span class=o>=</span> <span class=n>MID_NODE</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                    <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=c1>// éå†çª—å£å†…çš„æ¯ä¸ªç‚¹äº‘ï¼Œæ ¹æ®ç‚¹çš„ä½ç½®å°†å…¶åˆ†é…åˆ°ç›¸åº”çš„å­èŠ‚ç‚¹
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>win_size</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=n>uint</span> <span class=n>pt_size</span> <span class=o>=</span> <span class=n>baseTransPc</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>-&gt;</span><span class=n>size</span><span class=p>();</span>
</span></span><span class=line><span class=cl>                    <span class=k>for</span> <span class=p>(</span><span class=n>size_t</span> <span class=n>j</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>j</span> <span class=o>&lt;</span> <span class=n>pt_size</span><span class=p>;</span> <span class=n>j</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=kt>int</span> <span class=n>xyz</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span><span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>};</span>
</span></span><span class=line><span class=cl>                        <span class=k>for</span> <span class=p>(</span><span class=n>size_t</span> <span class=n>k</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>k</span> <span class=o>&lt;</span> <span class=mi>3</span><span class=p>;</span> <span class=n>k</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                            <span class=k>if</span> <span class=p>((</span><span class=o>*</span><span class=n>baseTransPc</span><span class=p>[</span><span class=n>i</span><span class=p>])[</span><span class=n>j</span><span class=p>][</span><span class=n>k</span><span class=p>]</span> <span class=o>&gt;</span> <span class=n>voxel_center</span><span class=p>[</span><span class=n>k</span><span class=p>])</span>
</span></span><span class=line><span class=cl>                                <span class=n>xyz</span><span class=p>[</span><span class=n>k</span><span class=p>]</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                        <span class=kt>int</span> <span class=n>leafnum</span> <span class=o>=</span> <span class=mi>4</span> <span class=o>*</span> <span class=n>xyz</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>+</span> <span class=mi>2</span> <span class=o>*</span> <span class=n>xyz</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>+</span> <span class=n>xyz</span><span class=p>[</span><span class=mi>2</span><span class=p>];</span>
</span></span><span class=line><span class=cl>                          <span class=c1>// å¦‚æœå½“å‰å­èŠ‚ç‚¹ä¸ºç©ºï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„å…«å‰æ ‘èŠ‚ç‚¹ï¼Œå¹¶è®¾ç½®å…¶å‚æ•°
</span></span></span><span class=line><span class=cl><span class=c1></span>                        <span class=k>if</span> <span class=p>(</span><span class=n>leaves</span><span class=p>[</span><span class=n>leafnum</span><span class=p>]</span> <span class=o>==</span> <span class=k>nullptr</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                            <span class=n>leaves</span><span class=p>[</span><span class=n>leafnum</span><span class=p>]</span> <span class=o>=</span> <span class=k>new</span> <span class=n>OCTO_TREE</span><span class=p>(</span><span class=n>win_size</span><span class=p>,</span> <span class=n>ref_size</span><span class=p>,</span> <span class=n>eigen_ratio</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                            <span class=n>leaves</span><span class=p>[</span><span class=n>leafnum</span><span class=p>]</span><span class=o>-&gt;</span><span class=n>voxel_center</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=n>voxel_center</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>+</span> <span class=p>(</span><span class=mi>2</span> <span class=o>*</span> <span class=n>xyz</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span> <span class=o>*</span> <span class=n>quater_length</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                            <span class=n>leaves</span><span class=p>[</span><span class=n>leafnum</span><span class=p>]</span><span class=o>-&gt;</span><span class=n>voxel_center</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=n>voxel_center</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>+</span> <span class=p>(</span><span class=mi>2</span> <span class=o>*</span> <span class=n>xyz</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span> <span class=o>*</span> <span class=n>quater_length</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                            <span class=n>leaves</span><span class=p>[</span><span class=n>leafnum</span><span class=p>]</span><span class=o>-&gt;</span><span class=n>voxel_center</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>=</span> <span class=n>voxel_center</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>+</span> <span class=p>(</span><span class=mi>2</span> <span class=o>*</span> <span class=n>xyz</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span> <span class=o>*</span> <span class=n>quater_length</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                            <span class=n>leaves</span><span class=p>[</span><span class=n>leafnum</span><span class=p>]</span><span class=o>-&gt;</span><span class=n>quater_length</span> <span class=o>=</span> <span class=n>quater_length</span> <span class=o>/</span> <span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                            <span class=n>leaves</span><span class=p>[</span><span class=n>leafnum</span><span class=p>]</span><span class=o>-&gt;</span><span class=n>layer</span> <span class=o>=</span> <span class=n>layer</span> <span class=o>+</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                        <span class=p>}</span>
</span></span><span class=line><span class=cl>                        <span class=n>leaves</span><span class=p>[</span><span class=n>leafnum</span><span class=p>]</span><span class=o>-&gt;</span><span class=n>baseOriginPc</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>-&gt;</span><span class=n>emplace_back</span><span class=p>((</span><span class=o>*</span><span class=n>baseOriginPc</span><span class=p>[</span><span class=n>i</span><span class=p>])[</span><span class=n>j</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>                        <span class=n>leaves</span><span class=p>[</span><span class=n>leafnum</span><span class=p>]</span><span class=o>-&gt;</span><span class=n>baseTransPc</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>-&gt;</span><span class=n>emplace_back</span><span class=p>((</span><span class=o>*</span><span class=n>baseTransPc</span><span class=p>[</span><span class=n>i</span><span class=p>])[</span><span class=n>j</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>                    <span class=p>}</span>
</span></span><span class=line><span class=cl>                    <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>k</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>k</span> <span class=o>&lt;</span> <span class=n>ref_size</span><span class=p>;</span> <span class=n>k</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=n>pt_size</span> <span class=o>=</span> <span class=n>refTransPc</span><span class=p>[</span><span class=n>k</span><span class=p>][</span><span class=n>i</span><span class=p>]</span><span class=o>-&gt;</span><span class=n>size</span><span class=p>();</span>
</span></span><span class=line><span class=cl>                        <span class=k>for</span> <span class=p>(</span><span class=n>size_t</span> <span class=n>j</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>j</span> <span class=o>&lt;</span> <span class=n>pt_size</span><span class=p>;</span> <span class=n>j</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                            <span class=kt>int</span> <span class=n>xyz</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span><span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>};</span>
</span></span><span class=line><span class=cl>                            <span class=k>for</span> <span class=p>(</span><span class=n>size_t</span> <span class=n>a</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>a</span> <span class=o>&lt;</span> <span class=mi>3</span><span class=p>;</span> <span class=n>a</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                                <span class=k>if</span> <span class=p>((</span><span class=o>*</span><span class=n>refTransPc</span><span class=p>[</span><span class=n>k</span><span class=p>][</span><span class=n>i</span><span class=p>])[</span><span class=n>j</span><span class=p>][</span><span class=n>a</span><span class=p>]</span> <span class=o>&gt;</span> <span class=n>voxel_center</span><span class=p>[</span><span class=n>a</span><span class=p>])</span>
</span></span><span class=line><span class=cl>                                    <span class=n>xyz</span><span class=p>[</span><span class=n>a</span><span class=p>]</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                            <span class=kt>int</span> <span class=n>leafnum</span> <span class=o>=</span> <span class=mi>4</span> <span class=o>*</span> <span class=n>xyz</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>+</span> <span class=mi>2</span> <span class=o>*</span> <span class=n>xyz</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>+</span> <span class=n>xyz</span><span class=p>[</span><span class=mi>2</span><span class=p>];</span>
</span></span><span class=line><span class=cl>                            <span class=k>if</span> <span class=p>(</span><span class=n>leaves</span><span class=p>[</span><span class=n>leafnum</span><span class=p>]</span> <span class=o>==</span> <span class=k>nullptr</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                                <span class=n>leaves</span><span class=p>[</span><span class=n>leafnum</span><span class=p>]</span> <span class=o>=</span> <span class=k>new</span> <span class=n>OCTO_TREE</span><span class=p>(</span><span class=n>win_size</span><span class=p>,</span> <span class=n>ref_size</span><span class=p>,</span> <span class=n>eigen_ratio</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                                <span class=n>leaves</span><span class=p>[</span><span class=n>leafnum</span><span class=p>]</span><span class=o>-&gt;</span><span class=n>voxel_center</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=n>voxel_center</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>+</span> <span class=p>(</span><span class=mi>2</span> <span class=o>*</span> <span class=n>xyz</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span> <span class=o>*</span> <span class=n>quater_length</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                                <span class=n>leaves</span><span class=p>[</span><span class=n>leafnum</span><span class=p>]</span><span class=o>-&gt;</span><span class=n>voxel_center</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=n>voxel_center</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>+</span> <span class=p>(</span><span class=mi>2</span> <span class=o>*</span> <span class=n>xyz</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span> <span class=o>*</span> <span class=n>quater_length</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                                <span class=n>leaves</span><span class=p>[</span><span class=n>leafnum</span><span class=p>]</span><span class=o>-&gt;</span><span class=n>voxel_center</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>=</span> <span class=n>voxel_center</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>+</span> <span class=p>(</span><span class=mi>2</span> <span class=o>*</span> <span class=n>xyz</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span> <span class=o>*</span> <span class=n>quater_length</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                                <span class=n>leaves</span><span class=p>[</span><span class=n>leafnum</span><span class=p>]</span><span class=o>-&gt;</span><span class=n>quater_length</span> <span class=o>=</span> <span class=n>quater_length</span> <span class=o>/</span> <span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                                <span class=n>leaves</span><span class=p>[</span><span class=n>leafnum</span><span class=p>]</span><span class=o>-&gt;</span><span class=n>layer</span> <span class=o>=</span> <span class=n>layer</span> <span class=o>+</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                            <span class=p>}</span>
</span></span><span class=line><span class=cl>                            <span class=n>leaves</span><span class=p>[</span><span class=n>leafnum</span><span class=p>]</span><span class=o>-&gt;</span><span class=n>refOriginPc</span><span class=p>[</span><span class=n>k</span><span class=p>][</span><span class=n>i</span><span class=p>]</span><span class=o>-&gt;</span><span class=n>emplace_back</span><span class=p>((</span><span class=o>*</span><span class=n>refOriginPc</span><span class=p>[</span><span class=n>k</span><span class=p>][</span><span class=n>i</span><span class=p>])[</span><span class=n>j</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>                            <span class=n>leaves</span><span class=p>[</span><span class=n>leafnum</span><span class=p>]</span><span class=o>-&gt;</span><span class=n>refTransPc</span><span class=p>[</span><span class=n>k</span><span class=p>][</span><span class=n>i</span><span class=p>]</span><span class=o>-&gt;</span><span class=n>emplace_back</span><span class=p>((</span><span class=o>*</span><span class=n>refTransPc</span><span class=p>[</span><span class=n>k</span><span class=p>][</span><span class=n>i</span><span class=p>])[</span><span class=n>j</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>                        <span class=p>}</span>
</span></span><span class=line><span class=cl>                    <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=n>size_t</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=mi>8</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>leaves</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>!=</span> <span class=k>nullptr</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>leaves</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>-&gt;</span><span class=n>recut</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>   <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>    * @brief è®¡ç®—å’Œåˆ¤æ–­ç»™å®šç‚¹äº‘æ•°æ®çš„åæ–¹å·®çŸ©é˜µçš„ç‰¹å¾å€¼çš„æ¯”å€¼
</span></span></span><span class=line><span class=cl><span class=cm>                æ˜¯æœ¬æ–‡2.1èŠ‚çš„åæ–¹å·®çŸ©é˜µè®¡ç®—çš„å…·ä½“å®ç°
</span></span></span><span class=line><span class=cl><span class=cm>    * @return bool æ ¹æ®ç‰¹å¾å€¼çš„æ¯”å€¼åˆ¤æ–­è¿”å›trueæˆ–false
</span></span></span><span class=line><span class=cl><span class=cm>    */</span>
</span></span><span class=line><span class=cl>    <span class=kt>bool</span> <span class=nf>judge_eigen</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Eigen</span><span class=o>::</span><span class=n>Matrix3d</span> <span class=n>covMat</span><span class=p>(</span><span class=n>Eigen</span><span class=o>::</span><span class=n>Matrix3d</span><span class=o>::</span><span class=n>Zero</span><span class=p>());</span>
</span></span><span class=line><span class=cl>        <span class=n>Eigen</span><span class=o>::</span><span class=n>Vector3d</span> <span class=n>center</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>uint</span> <span class=n>pt_size</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>win_size</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>pt_size</span> <span class=o>=</span> <span class=n>baseTransPc</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>-&gt;</span><span class=n>size</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=p>(</span><span class=n>size_t</span> <span class=n>j</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>j</span> <span class=o>&lt;</span> <span class=n>pt_size</span><span class=p>;</span> <span class=n>j</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>covMat</span> <span class=o>+=</span> <span class=p>(</span><span class=o>*</span><span class=n>baseTransPc</span><span class=p>[</span><span class=n>i</span><span class=p>])[</span><span class=n>j</span><span class=p>]</span> <span class=o>*</span> <span class=p>(</span><span class=o>*</span><span class=n>baseTransPc</span><span class=p>[</span><span class=n>i</span><span class=p>])[</span><span class=n>j</span><span class=p>].</span><span class=n>transpose</span><span class=p>();</span>
</span></span><span class=line><span class=cl>                <span class=n>center</span> <span class=o>+=</span> <span class=p>(</span><span class=o>*</span><span class=n>baseTransPc</span><span class=p>[</span><span class=n>i</span><span class=p>])[</span><span class=n>j</span><span class=p>];</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>k</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>k</span> <span class=o>&lt;</span> <span class=n>ref_size</span><span class=p>;</span> <span class=n>k</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>pt_size</span> <span class=o>=</span> <span class=n>refTransPc</span><span class=p>[</span><span class=n>k</span><span class=p>][</span><span class=n>i</span><span class=p>]</span><span class=o>-&gt;</span><span class=n>size</span><span class=p>();</span>
</span></span><span class=line><span class=cl>                <span class=k>for</span> <span class=p>(</span><span class=n>size_t</span> <span class=n>j</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>j</span> <span class=o>&lt;</span> <span class=n>pt_size</span><span class=p>;</span> <span class=n>j</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=n>covMat</span> <span class=o>+=</span> <span class=p>(</span><span class=o>*</span><span class=n>refTransPc</span><span class=p>[</span><span class=n>k</span><span class=p>][</span><span class=n>i</span><span class=p>])[</span><span class=n>j</span><span class=p>]</span> <span class=o>*</span> <span class=p>(</span><span class=o>*</span><span class=n>refTransPc</span><span class=p>[</span><span class=n>k</span><span class=p>][</span><span class=n>i</span><span class=p>])[</span><span class=n>j</span><span class=p>].</span><span class=n>transpose</span><span class=p>();</span>
</span></span><span class=line><span class=cl>                    <span class=n>center</span> <span class=o>+=</span> <span class=p>(</span><span class=o>*</span><span class=n>refTransPc</span><span class=p>[</span><span class=n>k</span><span class=p>][</span><span class=n>i</span><span class=p>])[</span><span class=n>j</span><span class=p>];</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=c1>//è®¡ç®—ä¸­å¿ƒç‚¹
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>center</span> <span class=o>/=</span> <span class=n>points_size</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=c1>//è®¡ç®—åæ–¹å·®çŸ©é˜µ
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>covMat</span> <span class=o>=</span> <span class=n>covMat</span> <span class=o>/</span> <span class=n>points_size</span> <span class=o>-</span> <span class=n>center</span> <span class=o>*</span> <span class=n>center</span><span class=p>.</span><span class=n>transpose</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=cm>/* saes.eigenvalues()[2] is the biggest */</span>
</span></span><span class=line><span class=cl>        <span class=n>Eigen</span><span class=o>::</span><span class=n>SelfAdjointEigenSolver</span><span class=o>&lt;</span><span class=n>Eigen</span><span class=o>::</span><span class=n>Matrix3d</span><span class=o>&gt;</span> <span class=n>saes</span><span class=p>(</span><span class=n>covMat</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>value_vector</span> <span class=o>=</span> <span class=n>saes</span><span class=p>.</span><span class=n>eigenvalues</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=c1>// åˆ¤æ–­ç‰¹å¾å€¼çš„æ¯”å€¼æ˜¯å¦å¤§äºç»™å®šçš„é˜ˆå€¼ï¼Œæ˜¯åˆ™è¿”å›trueï¼Œå¦åˆ™è¿”å›false  
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>if</span> <span class=p>(</span><span class=n>eigen_ratio</span> <span class=o>&lt;</span> <span class=n>saes</span><span class=p>.</span><span class=n>eigenvalues</span><span class=p>()[</span><span class=mi>2</span><span class=p>]</span> <span class=o>/</span> <span class=n>saes</span><span class=p>.</span><span class=n>eigenvalues</span><span class=p>()[</span><span class=mi>0</span><span class=p>])</span> <span class=k>return</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * @brief é€’å½’å»å°†å¹³é¢èŠ‚ç‚¹ä¼ é€’ç»™LMä¼˜åŒ–å™¨
</span></span></span><span class=line><span class=cl><span class=cm>     **/</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>feed_pt</span><span class=p>(</span><span class=n>LM_OPTIMIZER</span> <span class=o>&amp;</span><span class=n>lm_opt</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>octo_state</span> <span class=o>==</span> <span class=n>PLANE</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>lm_opt</span><span class=p>.</span><span class=n>push_voxel</span><span class=p>(</span><span class=n>baseOriginPc</span><span class=p>,</span> <span class=n>refOriginPc</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=mi>8</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=p>(</span><span class=n>leaves</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>!=</span> <span class=k>nullptr</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=n>leaves</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>-&gt;</span><span class=n>feed_pt</span><span class=p>(</span><span class=n>lm_opt</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=downsample_voxelä½“ç´ ä¸‹é‡‡æ ·å‡½æ•°>downsample_voxelä½“ç´ ä¸‹é‡‡æ ·å‡½æ•°</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-C++ data-lang=C++><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * @brief åŸºäºä½“ç´ ç½‘æ ¼å¯¹ç‚¹äº‘è¿›è¡Œä¸‹é‡‡æ ·
</span></span></span><span class=line><span class=cl><span class=cm> *        æœ¬æ–‡è‡ªé€‚åº”ä½“ç´ åŒ–ç« èŠ‚æåˆ°ï¼Œå¦‚æœä¸€ä¸ªä½“ç´ å†…åŒ…å«å¤ªå¤šç‚¹ï¼Œ
</span></span></span><span class=line><span class=cl><span class=cm> *        åˆ™ä¼šå¯¼è‡´äºŒé˜¶é—­å¼å¯¼æ•°ä¸­çš„HessiançŸ©é˜µç»´åº¦è¿‡é«˜ï¼Œåœ¨è¿™ç§
</span></span></span><span class=line><span class=cl><span class=cm> *        æƒ…å†µä¸‹å¯ä»¥è¿›è¡Œå°†ç‚¹è¿›è¡Œä¸€ä¸‹å¹³å‡ï¼Œä»¥é™ä½ç»´åº¦
</span></span></span><span class=line><span class=cl><span class=cm> * @param pc è¾“å…¥å’Œè¾“å‡ºçš„ç‚¹äº‘æ•°æ®
</span></span></span><span class=line><span class=cl><span class=cm> * @param voxel_size ä½“ç´ ç½‘æ ¼çš„å¤§å°ï¼Œå†³å®šäº†ä¸‹é‡‡æ ·çš„ç²¾åº¦
</span></span></span><span class=line><span class=cl><span class=cm> * @return
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>downsample_voxel</span><span class=p>(</span><span class=n>pcl</span><span class=o>::</span><span class=n>PointCloud</span><span class=o>&lt;</span><span class=n>PointType</span><span class=o>&gt;&amp;</span> <span class=n>pc</span><span class=p>,</span> <span class=kt>double</span> <span class=n>voxel_size</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// æ£€æŸ¥ä½“ç´ å¤§å°æ˜¯å¦è¿‡å°ï¼Œå¦‚æœå°äº0.01åˆ™ä¸è¿›è¡Œä¸‹é‡‡æ ·
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span> <span class=p>(</span><span class=n>voxel_size</span> <span class=o>&lt;</span> <span class=mf>0.01</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// ä½¿ç”¨å“ˆå¸Œè¡¨å­˜å‚¨æ¯ä¸ªä½“ç´ ç½‘æ ¼ä¸­çš„ç‚¹ï¼Œä»¥å®ç°å¿«é€ŸæŸ¥æ‰¾å’Œå»é‡
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>std</span><span class=o>::</span><span class=n>unordered_map</span><span class=o>&lt;</span><span class=n>VOXEL_LOC</span><span class=p>,</span> <span class=n>M_POINT</span><span class=o>&gt;</span> <span class=n>feature_map</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>size_t</span> <span class=n>pt_size</span> <span class=o>=</span> <span class=n>pc</span><span class=p>.</span><span class=n>size</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// éå†æ¯ä¸ªç‚¹ï¼Œè®¡ç®—å…¶åœ¨ä½“ç´ ç½‘æ ¼ä¸­çš„ä½ç½®ï¼Œå¹¶å°†ç‚¹åŠ å…¥ç›¸åº”çš„ä½“ç´ ç½‘æ ¼
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>for</span> <span class=p>(</span><span class=n>size_t</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>pt_size</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>PointType</span> <span class=o>&amp;</span><span class=n>pt_trans</span> <span class=o>=</span> <span class=n>pc</span><span class=p>[</span><span class=n>i</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=kt>float</span> <span class=n>loc_xyz</span><span class=p>[</span><span class=mi>3</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=c1>// è®¡ç®—ç‚¹åœ¨æ¯ä¸ªç»´åº¦ä¸Šæ‰€åœ¨çš„ä½“ç´ ç½‘æ ¼ç´¢å¼•
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>j</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>j</span> <span class=o>&lt;</span> <span class=mi>3</span><span class=p>;</span> <span class=n>j</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>loc_xyz</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=o>=</span> <span class=n>pt_trans</span><span class=p>.</span><span class=n>data</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=o>/</span> <span class=n>voxel_size</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=c1>// å¦‚æœç‚¹çš„ä½“ç´ ç½‘æ ¼ç´¢å¼•å°äº0ï¼Œåˆ™å‡å»1ï¼Œä¿è¯ç´¢å¼•éè´Ÿ
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=k>if</span> <span class=p>(</span><span class=n>loc_xyz</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=o>&lt;</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>loc_xyz</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=o>-=</span> <span class=mf>1.0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// æ„é€ ä½“ç´ ç½‘æ ¼ä½ç½®çš„é”®
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>VOXEL_LOC</span> <span class=n>position</span><span class=p>((</span><span class=kt>int64_t</span><span class=p>)</span><span class=n>loc_xyz</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=p>(</span><span class=kt>int64_t</span><span class=p>)</span><span class=n>loc_xyz</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=p>(</span><span class=kt>int64_t</span><span class=p>)</span><span class=n>loc_xyz</span><span class=p>[</span><span class=mi>2</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>        <span class=c1>// åœ¨å“ˆå¸Œè¡¨ä¸­æŸ¥æ‰¾å½“å‰ä½“ç´ ç½‘æ ¼ä½ç½®
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>auto</span> <span class=n>iter</span> <span class=o>=</span> <span class=n>feature_map</span><span class=p>.</span><span class=n>find</span><span class=p>(</span><span class=n>position</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>iter</span> <span class=o>!=</span> <span class=n>feature_map</span><span class=p>.</span><span class=n>end</span><span class=p>())</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>// å¦‚æœå½“å‰ä½“ç´ ç½‘æ ¼å·²å­˜åœ¨ç‚¹ï¼Œåˆ™ç´¯åŠ ç‚¹çš„åæ ‡ï¼Œå¹¶å¢åŠ ç‚¹çš„è®¡æ•°
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=n>iter</span><span class=o>-&gt;</span><span class=n>second</span><span class=p>.</span><span class=n>xyz</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>+=</span> <span class=n>pt_trans</span><span class=p>.</span><span class=n>x</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>iter</span><span class=o>-&gt;</span><span class=n>second</span><span class=p>.</span><span class=n>xyz</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>+=</span> <span class=n>pt_trans</span><span class=p>.</span><span class=n>y</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>iter</span><span class=o>-&gt;</span><span class=n>second</span><span class=p>.</span><span class=n>xyz</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>+=</span> <span class=n>pt_trans</span><span class=p>.</span><span class=n>z</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>iter</span><span class=o>-&gt;</span><span class=n>second</span><span class=p>.</span><span class=n>count</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>// å¦‚æœå½“å‰ä½“ç´ ç½‘æ ¼ä¸å­˜åœ¨ç‚¹ï¼Œåˆ™åˆ›å»ºæ–°çš„ä½“ç´ ç½‘æ ¼ç‚¹ï¼Œå¹¶åŠ å…¥å“ˆå¸Œè¡¨
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=n>M_POINT</span> <span class=n>anp</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>anp</span><span class=p>.</span><span class=n>xyz</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=n>pt_trans</span><span class=p>.</span><span class=n>x</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>anp</span><span class=p>.</span><span class=n>xyz</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=n>pt_trans</span><span class=p>.</span><span class=n>y</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>anp</span><span class=p>.</span><span class=n>xyz</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>=</span> <span class=n>pt_trans</span><span class=p>.</span><span class=n>z</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>anp</span><span class=p>.</span><span class=n>count</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>feature_map</span><span class=p>[</span><span class=n>position</span><span class=p>]</span> <span class=o>=</span> <span class=n>anp</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// é‡æ–°è®¡ç®—ä¸‹é‡‡æ ·åçš„ç‚¹äº‘å¤§å°ï¼Œå¹¶æ¸…ç©ºåŸæœ‰æ•°æ®
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>pt_size</span> <span class=o>=</span> <span class=n>feature_map</span><span class=p>.</span><span class=n>size</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=n>pc</span><span class=p>.</span><span class=n>clear</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=n>pc</span><span class=p>.</span><span class=n>resize</span><span class=p>(</span><span class=n>pt_size</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// éå†å“ˆå¸Œè¡¨ï¼Œè®¡ç®—æ¯ä¸ªä½“ç´ ç½‘æ ¼ç‚¹çš„å¹³å‡åæ ‡ï¼Œå¹¶å¡«å……åˆ°è¾“å‡ºç‚¹äº‘æ•°æ®ä¸­
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>size_t</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=k>auto</span> <span class=n>iter</span> <span class=o>=</span> <span class=n>feature_map</span><span class=p>.</span><span class=n>begin</span><span class=p>();</span> <span class=n>iter</span> <span class=o>!=</span> <span class=n>feature_map</span><span class=p>.</span><span class=n>end</span><span class=p>();</span> <span class=o>++</span><span class=n>iter</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>pc</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>x</span> <span class=o>=</span> <span class=n>iter</span><span class=o>-&gt;</span><span class=n>second</span><span class=p>.</span><span class=n>xyz</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>/</span> <span class=n>iter</span><span class=o>-&gt;</span><span class=n>second</span><span class=p>.</span><span class=n>count</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>pc</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>y</span> <span class=o>=</span> <span class=n>iter</span><span class=o>-&gt;</span><span class=n>second</span><span class=p>.</span><span class=n>xyz</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>/</span> <span class=n>iter</span><span class=o>-&gt;</span><span class=n>second</span><span class=p>.</span><span class=n>count</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>pc</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>z</span> <span class=o>=</span> <span class=n>iter</span><span class=o>-&gt;</span><span class=n>second</span><span class=p>.</span><span class=n>xyz</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>/</span> <span class=n>iter</span><span class=o>-&gt;</span><span class=n>second</span><span class=p>.</span><span class=n>count</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>i</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=cut_voxelä½“ç´ è£å‰ªå‡½æ•°>cut_voxelä½“ç´ è£å‰ªå‡½æ•°</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-C++ data-lang=C++><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * @brief åˆ‡å‰²ä½“ç´ å‡½æ•°ï¼Œç”¨äºå¤„ç†ç‰¹å¾ç‚¹äº‘å¹¶æ„å»ºä½“ç´ ç‰¹å¾æ˜ å°„
</span></span></span><span class=line><span class=cl><span class=cm> *
</span></span></span><span class=line><span class=cl><span class=cm> * @param feature_map ç‰¹å¾æ˜ å°„ï¼Œé”®ä¸ºä½“ç´ ä½ç½®ï¼Œå€¼ä¸ºä½“ç´ æ ‘æŒ‡é’ˆ
</span></span></span><span class=line><span class=cl><span class=cm> * @param feature_pts ç‰¹å¾ç‚¹äº‘æ•°æ®æŒ‡é’ˆ
</span></span></span><span class=line><span class=cl><span class=cm> * @param q æ—‹è½¬çŸ©é˜µï¼Œè¡¨ç¤ºç‚¹äº‘çš„æ—‹è½¬æƒ…å†µ åœ¨æœ¬æ–‡ä¸­æ¥æºäºåˆå§‹å¯ç”¨çš„åŸºå‡†é›·è¾¾çš„è½¨è¿¹$\mathcal{S}$
</span></span></span><span class=line><span class=cl><span class=cm> * @param t å¹³ç§»å‘é‡ï¼Œè¡¨ç¤ºç‚¹äº‘çš„å¹³ç§»æƒ…å†µ åœ¨æœ¬æ–‡ä¸­æ¥æºäºåˆå§‹å¯ç”¨çš„åŸºå‡†é›·è¾¾çš„è½¨è¿¹$\mathcal{S}$
</span></span></span><span class=line><span class=cl><span class=cm> * @param f_head ç”¨äºç‰¹å¾å­˜å‚¨çš„å¤´éƒ¨ç´¢å¼•
</span></span></span><span class=line><span class=cl><span class=cm> * @param baselidar_sz åŸºç¡€æ¿€å…‰é›·è¾¾æ•°æ®çš„ä½“ç´ å°ºå¯¸
</span></span></span><span class=line><span class=cl><span class=cm> * @param exlidar_sz æ‰©å±•æ¿€å…‰é›·è¾¾æ•°æ®çš„ä½“ç´ å°ºå¯¸
</span></span></span><span class=line><span class=cl><span class=cm> * @param eigen_threshold ç‰¹å¾å€¼é˜ˆå€¼ï¼Œç”¨äºä½“ç´ ç‰¹å¾æå–
</span></span></span><span class=line><span class=cl><span class=cm> * @param exlidar_n æ‰©å±•æ¿€å…‰é›·è¾¾çš„ç¼–å·ï¼Œé»˜è®¤ä¸º0
</span></span></span><span class=line><span class=cl><span class=cm> * @param is_base_lidar æ ‡è®°å½“å‰å¤„ç†çš„æ˜¯åŸºç¡€æ¿€å…‰é›·è¾¾æ•°æ®è¿˜æ˜¯æ‰©å±•æ¿€å…‰é›·è¾¾æ•°æ®ï¼Œé»˜è®¤ä¸ºtrue
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>cut_voxel</span><span class=p>(</span><span class=n>unordered_map</span><span class=o>&lt;</span><span class=n>VOXEL_LOC</span><span class=p>,</span> <span class=n>OCTO_TREE</span> <span class=o>*&gt;</span> <span class=o>&amp;</span><span class=n>feature_map</span><span class=p>,</span>
</span></span><span class=line><span class=cl>               <span class=n>pcl</span><span class=o>::</span><span class=n>PointCloud</span><span class=o>&lt;</span><span class=n>PointType</span><span class=o>&gt;::</span><span class=n>Ptr</span> <span class=n>feature_pts</span><span class=p>,</span>
</span></span><span class=line><span class=cl>               <span class=n>Eigen</span><span class=o>::</span><span class=n>Quaterniond</span> <span class=n>q</span><span class=p>,</span> <span class=n>Eigen</span><span class=o>::</span><span class=n>Vector3d</span> <span class=n>t</span><span class=p>,</span> <span class=kt>int</span> <span class=n>f_head</span><span class=p>,</span> <span class=kt>int</span> <span class=n>baselidar_sz</span><span class=p>,</span>
</span></span><span class=line><span class=cl>               <span class=kt>int</span> <span class=n>exlidar_sz</span><span class=p>,</span> <span class=kt>double</span> <span class=n>eigen_threshold</span><span class=p>,</span> <span class=kt>int</span> <span class=n>exlidar_n</span> <span class=o>=</span> <span class=mi>0</span><span class=p>,</span> <span class=kt>bool</span> <span class=n>is_base_lidar</span> <span class=o>=</span> <span class=nb>true</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>uint</span> <span class=n>pt_size</span> <span class=o>=</span> <span class=n>feature_pts</span><span class=o>-&gt;</span><span class=n>size</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=n>uint</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>pt_size</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>PointType</span> <span class=o>&amp;</span><span class=n>pt</span> <span class=o>=</span> <span class=n>feature_pts</span><span class=o>-&gt;</span><span class=n>points</span><span class=p>[</span><span class=n>i</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=n>Eigen</span><span class=o>::</span><span class=n>Vector3d</span> <span class=n>pt_origin</span><span class=p>(</span><span class=n>pt</span><span class=p>.</span><span class=n>x</span><span class=p>,</span> <span class=n>pt</span><span class=p>.</span><span class=n>y</span><span class=p>,</span> <span class=n>pt</span><span class=p>.</span><span class=n>z</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=c1>// å°†ç‚¹è¿›è¡Œæ—‹è½¬å’Œå¹³ç§»å˜æ¢,è½¬åŒ–åˆ°ä¸–ç•Œåæ ‡ç³»ä¸­
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>Eigen</span><span class=o>::</span><span class=n>Vector3d</span> <span class=n>pt_trans</span> <span class=o>=</span> <span class=n>q</span> <span class=o>*</span> <span class=n>pt_origin</span> <span class=o>+</span> <span class=n>t</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// è®¡ç®—ç‚¹åœ¨ä½“ç´ ç½‘æ ¼ä¸­çš„ä½ç½®
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kt>float</span> <span class=n>loc_xyz</span><span class=p>[</span><span class=mi>3</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>j</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>j</span> <span class=o>&lt;</span> <span class=mi>3</span><span class=p>;</span> <span class=n>j</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>loc_xyz</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=o>=</span> <span class=n>pt_trans</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=o>/</span> <span class=n>voxel_size</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>loc_xyz</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=o>&lt;</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>loc_xyz</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=o>-=</span> <span class=mf>1.0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// æ„å»ºä½“ç´ ä½ç½®é”®
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>VOXEL_LOC</span> <span class=n>position</span><span class=p>((</span><span class=kt>int64_t</span><span class=p>)</span> <span class=n>loc_xyz</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=p>(</span><span class=kt>int64_t</span><span class=p>)</span> <span class=n>loc_xyz</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=p>(</span><span class=kt>int64_t</span><span class=p>)</span> <span class=n>loc_xyz</span><span class=p>[</span><span class=mi>2</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>        <span class=c1>// æ£€æŸ¥è¯¥ä½“ç´ ä½ç½®æ˜¯å¦å·²å­˜åœ¨äºç‰¹å¾æ˜ å°„ä¸­
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>auto</span> <span class=n>iter</span> <span class=o>=</span> <span class=n>feature_map</span><span class=p>.</span><span class=n>find</span><span class=p>(</span><span class=n>position</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>iter</span> <span class=o>!=</span> <span class=n>feature_map</span><span class=p>.</span><span class=n>end</span><span class=p>())</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>// å¦‚æœå­˜åœ¨ï¼Œåˆ™å‘è¯¥ä½“ç´ ä¸­æ·»åŠ ç‚¹æ•°æ®
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=k>if</span> <span class=p>(</span><span class=n>is_base_lidar</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>iter</span><span class=o>-&gt;</span><span class=n>second</span><span class=o>-&gt;</span><span class=n>baseOriginPc</span><span class=p>[</span><span class=n>f_head</span><span class=p>]</span><span class=o>-&gt;</span><span class=n>emplace_back</span><span class=p>(</span><span class=n>pt_origin</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=n>iter</span><span class=o>-&gt;</span><span class=n>second</span><span class=o>-&gt;</span><span class=n>baseTransPc</span><span class=p>[</span><span class=n>f_head</span><span class=p>]</span><span class=o>-&gt;</span><span class=n>emplace_back</span><span class=p>(</span><span class=n>pt_trans</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>iter</span><span class=o>-&gt;</span><span class=n>second</span><span class=o>-&gt;</span><span class=n>refOriginPc</span><span class=p>[</span><span class=n>exlidar_n</span><span class=p>][</span><span class=n>f_head</span><span class=p>]</span><span class=o>-&gt;</span><span class=n>emplace_back</span><span class=p>(</span><span class=n>pt_origin</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=n>iter</span><span class=o>-&gt;</span><span class=n>second</span><span class=o>-&gt;</span><span class=n>refTransPc</span><span class=p>[</span><span class=n>exlidar_n</span><span class=p>][</span><span class=n>f_head</span><span class=p>]</span><span class=o>-&gt;</span><span class=n>emplace_back</span><span class=p>(</span><span class=n>pt_trans</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>// å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºæ–°çš„ä½“ç´ æ ‘ï¼Œå¹¶å‘å…¶ä¸­æ·»åŠ ç‚¹æ•°æ®
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=n>OCTO_TREE</span> <span class=o>*</span><span class=n>ot</span> <span class=o>=</span> <span class=k>new</span> <span class=n>OCTO_TREE</span><span class=p>(</span><span class=n>baselidar_sz</span><span class=p>,</span> <span class=n>exlidar_sz</span><span class=p>,</span> <span class=n>eigen_threshold</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>is_base_lidar</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>ot</span><span class=o>-&gt;</span><span class=n>baseOriginPc</span><span class=p>[</span><span class=n>f_head</span><span class=p>]</span><span class=o>-&gt;</span><span class=n>emplace_back</span><span class=p>(</span><span class=n>pt_origin</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=n>ot</span><span class=o>-&gt;</span><span class=n>baseTransPc</span><span class=p>[</span><span class=n>f_head</span><span class=p>]</span><span class=o>-&gt;</span><span class=n>emplace_back</span><span class=p>(</span><span class=n>pt_trans</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>ot</span><span class=o>-&gt;</span><span class=n>refOriginPc</span><span class=p>[</span><span class=n>exlidar_n</span><span class=p>][</span><span class=n>f_head</span><span class=p>]</span><span class=o>-&gt;</span><span class=n>emplace_back</span><span class=p>(</span><span class=n>pt_origin</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=n>ot</span><span class=o>-&gt;</span><span class=n>refTransPc</span><span class=p>[</span><span class=n>exlidar_n</span><span class=p>][</span><span class=n>f_head</span><span class=p>]</span><span class=o>-&gt;</span><span class=n>emplace_back</span><span class=p>(</span><span class=n>pt_trans</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=c1>// è®¾ç½®ä½“ç´ æ ‘çš„ä¸­å¿ƒç‚¹å’Œé•¿åº¦
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=n>ot</span><span class=o>-&gt;</span><span class=n>voxel_center</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=mf>0.5</span> <span class=o>+</span> <span class=n>position</span><span class=p>.</span><span class=n>x</span><span class=p>)</span> <span class=o>*</span> <span class=n>voxel_size</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>ot</span><span class=o>-&gt;</span><span class=n>voxel_center</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=mf>0.5</span> <span class=o>+</span> <span class=n>position</span><span class=p>.</span><span class=n>y</span><span class=p>)</span> <span class=o>*</span> <span class=n>voxel_size</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>ot</span><span class=o>-&gt;</span><span class=n>voxel_center</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=mf>0.5</span> <span class=o>+</span> <span class=n>position</span><span class=p>.</span><span class=n>z</span><span class=p>)</span> <span class=o>*</span> <span class=n>voxel_size</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>ot</span><span class=o>-&gt;</span><span class=n>quater_length</span> <span class=o>=</span> <span class=n>voxel_size</span> <span class=o>/</span> <span class=mf>4.0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>ot</span><span class=o>-&gt;</span><span class=n>layer</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=c1>// å°†æ–°çš„ä½“ç´ æ ‘æ·»åŠ åˆ°ç‰¹å¾æ˜ å°„ä¸­
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=n>feature_map</span><span class=p>[</span><span class=n>position</span><span class=p>]</span> <span class=o>=</span> <span class=n>ot</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=å‚è€ƒæ–‡çŒ®>å‚è€ƒæ–‡çŒ®</h2><p>[1]<a class=link href=https://arxiv.org/pdf/2109.06550 target=_blank rel=noopener>ã€ŠTargetless Extrinsic Calibration of Multiple Small FoV LiDARs and Cameras using Adaptive Voxelizationã€‹</a></p><p>[2]<a class=link href=https://www.arxiv.org/pdf/2010.08215 target=_blank rel=noopener>ã€ŠBALM: Bundle Adjustment for Lidar Mappingã€‹</a></p><p>[3]<a class=link href=https://www.cnblogs.com/Glucklichste/p/11505743.html target=_blank rel=noopener>ã€Šoctreeå…«å‰æ ‘æ•°æ®ç»“æ„åŸç†ä¸å®ç°ã€‹</a></p></section><footer class=article-footer><section class=article-tags><a href=/tags/mlcc/>Mlcc</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section><section class=article-lastmod><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<span>æœ€åæ›´æ–°äº 2024-11-17 14:33 +0800</span></section></footer><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css integrity=sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV crossorigin=anonymous><script src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js integrity=sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8 crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js integrity=sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05 crossorigin=anonymous defer></script><script>window.addEventListener("DOMContentLoaded",()=>{renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}],ignoredClasses:["gist"]})})</script></article><aside class=related-content--wrapper><h2 class=section-title>ç›¸å…³æ–‡ç« </h2><div class=related-content><div class="flex article-list--tile"><article class=has-image><a href=/p/mlcc/02/><div class=article-image><img src=/p/mlcc/02/camera_voxel.127fe1f33eed6bad21fc61cb8af10709_hu6328242681866785286.png width=250 height=150 loading=lazy alt="Featured image of post Chapter 02: LiDAR-Camera Extrinsic Calibration" data-key=mlcc/02 data-hash="md5-En/h8z7ta60h/GHLivEHCQ=="></div><div class=article-details><h2 class=article-title>Chapter 02: LiDAR-Camera Extrinsic Calibration</h2></div></a></article><article class=has-image><a href=/p/mlcc/01/><div class=article-image><img src=/p/mlcc/01/dense_map.e48abd452232d123f32ea07779651292_hu11696070999330714789.jpg width=250 height=150 loading=lazy alt="Featured image of post Chapter 01: Multi-LiDAR Extrinsic Calibration" data-key=mlcc/01 data-hash="md5-5Iq9RSIy0SPzLqB3eWUSkg=="></div><div class=article-details><h2 class=article-title>Chapter 01: Multi-LiDAR Extrinsic Calibration</h2></div></a></article></div></div></aside><script src=https://utteranc.es/client.js repo=wzwan-developer/wzwan-developer.github.io issue-term=pathname crossorigin=anonymous async></script><style>.utterances{max-width:unset}</style><script>let utterancesLoaded=!1;function setUtterancesTheme(e){let t=document.querySelector(".utterances iframe");t&&t.contentWindow.postMessage({type:"set-theme",theme:`github-${e}`},"https://utteranc.es")}addEventListener("message",e=>{if(e.origin!=="https://utteranc.es")return;utterancesLoaded=!0,setUtterancesTheme(document.documentElement.dataset.scheme)}),window.addEventListener("onColorSchemeChange",e=>{if(!utterancesLoaded)return;setUtterancesTheme(e.detail)})</script><footer class=site-footer><section class=copyright>&copy;
2024 -
2025 wzwan<div class=busuanzi-footer><span id=busuanzi_container_site_pv>æœ¬ç«™æ€»è®¿é—®é‡<span id=busuanzi_value_site_pv></span>æ¬¡
</span><span id=busuanzi_container_site_uv>æœ¬ç«™è®¿å®¢æ•°<span id=busuanzi_value_site_uv></span>äººæ¬¡</span></div></section><section class=powerby>ä½¿ç”¨ <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> æ„å»º<br>ä¸»é¢˜ <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.26.0>Stack</a></b> ç”± <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> è®¾è®¡</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script><script src=/live2d-widget/autoload.js></script></body></html>